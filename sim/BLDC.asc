Version 4
SHEET 1 2796 1940
WIRE 464 -320 368 -320
WIRE 560 -320 528 -320
WIRE 752 -304 640 -304
WIRE 560 -288 544 -288
WIRE 496 -272 496 -288
WIRE 496 -272 368 -272
WIRE 544 -224 544 -288
WIRE 544 -224 368 -224
WIRE 752 -160 752 -304
WIRE 464 -144 368 -144
WIRE 560 -144 528 -144
WIRE 720 -128 640 -128
WIRE 864 -128 784 -128
WIRE 944 -128 864 -128
WIRE 560 -112 544 -112
WIRE 1120 -112 1024 -112
WIRE 1568 -112 1376 -112
WIRE 1728 -112 1632 -112
WIRE 496 -96 496 -112
WIRE 496 -96 368 -96
WIRE 944 -96 864 -96
WIRE 1888 -96 1808 -96
WIRE 2112 -96 1952 -96
WIRE 1728 -80 1696 -80
WIRE 544 -48 544 -112
WIRE 544 -48 368 -48
WIRE 1600 -32 1600 -80
WIRE 1600 -32 1552 -32
WIRE 2112 0 2112 -96
WIRE 864 16 864 -96
WIRE 1120 16 864 16
WIRE 1696 16 1696 -80
WIRE 1696 16 1664 16
WIRE 1888 16 1808 16
WIRE 464 32 368 32
WIRE 560 32 528 32
WIRE 2080 32 1968 32
WIRE 752 48 752 -96
WIRE 752 48 640 48
WIRE 1888 48 1840 48
WIRE 560 64 544 64
WIRE 496 80 496 64
WIRE 496 80 368 80
WIRE 1840 96 1840 48
WIRE 2016 96 1840 96
WIRE 544 128 544 64
WIRE 544 128 368 128
WIRE 1840 128 1840 96
WIRE 2016 144 2016 96
WIRE -304 224 -416 224
WIRE -144 224 -224 224
WIRE 80 224 -112 224
WIRE -128 272 -128 240
WIRE 80 272 -128 272
WIRE 1840 304 1840 192
WIRE 2112 304 2112 64
WIRE 2112 304 1840 304
WIRE -304 320 -416 320
WIRE -144 320 -224 320
WIRE 80 320 -112 320
WIRE 656 336 608 336
WIRE 704 336 656 336
WIRE -128 368 -128 336
WIRE 80 368 -128 368
WIRE 496 368 352 368
WIRE 1120 400 928 400
WIRE 1840 400 1840 304
WIRE 1840 400 1360 400
WIRE -304 416 -416 416
WIRE -144 416 -224 416
WIRE 80 416 -112 416
WIRE 464 416 352 416
WIRE 496 416 496 368
WIRE 512 416 496 416
WIRE 608 416 608 336
WIRE 608 416 576 416
WIRE 464 432 464 416
WIRE 512 432 464 432
WIRE 656 432 576 432
WIRE 704 432 656 432
WIRE 2016 432 1904 432
WIRE 512 448 464 448
WIRE 608 448 576 448
WIRE -128 464 -128 432
WIRE 80 464 -128 464
WIRE 464 464 464 448
WIRE 464 464 352 464
WIRE 512 464 496 464
WIRE 1600 464 1360 464
WIRE 1840 464 1840 400
WIRE 1840 464 1664 464
WIRE -256 512 -416 512
WIRE 80 512 -256 512
WIRE 496 512 496 464
WIRE 496 512 352 512
WIRE 608 528 608 448
WIRE 656 528 608 528
WIRE 704 528 656 528
WIRE 1120 528 992 528
WIRE 1904 528 1904 432
WIRE 1904 528 1360 528
WIRE 1984 544 1936 544
WIRE 2112 544 1984 544
WIRE 448 576 352 576
WIRE 560 592 560 480
WIRE 928 592 928 400
WIRE 928 592 560 592
WIRE 1936 592 1936 544
WIRE 1936 592 1360 592
WIRE 448 640 352 640
WIRE 1472 640 1360 640
WIRE 528 656 528 480
WIRE 816 656 528 656
WIRE 992 656 992 528
WIRE 992 656 880 656
WIRE 448 704 352 704
FLAG -416 224 FASE_A
IOPIN -416 224 In
FLAG -416 320 FASE_B
IOPIN -416 320 In
FLAG -416 416 FASE_C
IOPIN -416 416 In
FLAG -256 592 0
FLAG -416 512 Neutral
IOPIN -416 512 In
FLAG 784 336 0
FLAG 784 432 0
FLAG 784 528 0
FLAG 352 704 HALL_C
IOPIN 352 704 Out
FLAG 352 640 HALL_B
IOPIN 352 640 Out
FLAG 352 576 HALL_A
IOPIN 352 576 Out
FLAG 80 224 BEMFA
IOPIN 80 224 In
FLAG 368 -320 BEMFA
IOPIN 368 -320 In
FLAG 368 -272 Neutral
IOPIN 368 -272 In
FLAG 368 -224 I_A
IOPIN 368 -224 In
FLAG 80 272 I_A
IOPIN 80 272 Out
FLAG 80 368 I_B
IOPIN 80 368 Out
FLAG 80 464 I_C
IOPIN 80 464 Out
FLAG 80 320 BEMFB
IOPIN 80 320 In
FLAG 80 416 BEMFC
IOPIN 80 416 In
FLAG 368 -144 BEMFB
IOPIN 368 -144 In
FLAG 368 -96 Neutral
IOPIN 368 -96 In
FLAG 368 -48 I_B
IOPIN 368 -48 In
FLAG 368 32 BEMFC
IOPIN 368 32 In
FLAG 368 80 Neutral
IOPIN 368 80 In
FLAG 368 128 I_C
IOPIN 368 128 In
FLAG 864 -128 Pe_inst
FLAG 864 -96 wang
FLAG 1120 -112 Tmotor
IOPIN 1120 -112 Out
FLAG 1120 16 wang
IOPIN 1120 16 In
FLAG 80 512 Neutral
IOPIN 80 512 In
FLAG 352 368 BEMFA
IOPIN 352 368 Out
FLAG 352 512 Neutral
IOPIN 352 512 Out
FLAG 352 416 BEMFB
IOPIN 352 416 Out
FLAG 352 464 BEMFC
IOPIN 352 464 Out
FLAG 656 336 HALL_A
FLAG 656 432 HALL_B
FLAG 656 528 HALL_C
FLAG 1120 400 wang
IOPIN 1120 400 In
FLAG 1120 528 theta_t
IOPIN 1120 528 In
FLAG 1376 -112 Tmotor
IOPIN 1376 -112 In
FLAG 1552 -32 Tload
IOPIN 1552 -32 In
FLAG 1360 400 wang
IOPIN 1360 400 Out
FLAG 2016 144 theta_t
FLAG 1360 640 Tmotor
IOPIN 1360 640 Out
FLAG 1360 528 theta_t
IOPIN 1360 528 Out
FLAG 1360 464 rpm
IOPIN 1360 464 Out
FLAG 1360 592 theta
IOPIN 1360 592 Out
FLAG 2016 432 theta_t
FLAG 2112 624 0
FLAG 1984 624 0
SYMBOL BEMF 512 416 R0
SYMATTR SpiceLine KT=15e-3
SYMATTR InstName U1
SYMBOL ind -320 240 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value {Lm}
SYMATTR SpiceLine Rser={Rm}
SYMBOL ind -320 336 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L2
SYMATTR Value {Lm}
SYMATTR SpiceLine Rser={Rm}
SYMBOL ind -320 432 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L3
SYMATTR Value {Lm}
SYMATTR SpiceLine Rser={Rm}
SYMBOL res -240 608 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R1
SYMATTR Value 1G
SYMBOL res 688 352 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R2
SYMATTR Value 1G
SYMBOL res 688 448 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R3
SYMATTR Value 1G
SYMBOL res 688 544 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R4
SYMATTR Value 1G
SYMBOL Control\\isense -128 224 R0
WINDOW 0 -2 -38 Invisible 2
SYMATTR InstName U2
SYMBOL Control\\isense -128 320 R0
WINDOW 0 -2 -38 Invisible 2
SYMATTR InstName U3
SYMBOL Control\\isense -128 416 R0
WINDOW 0 -2 -38 Invisible 2
SYMATTR InstName U4
SYMBOL Control\\sub2 496 -320 R0
WINDOW 0 1 -38 Invisible 2
SYMATTR InstName U5
SYMBOL Control\\mul 592 -304 R0
WINDOW 0 0 -38 Invisible 2
SYMATTR InstName U6
SYMBOL Control\\sub2 496 -144 R0
WINDOW 0 1 -38 Invisible 2
SYMATTR InstName U7
SYMBOL Control\\mul 592 -128 R0
WINDOW 0 0 -38 Invisible 2
SYMATTR InstName U8
SYMBOL Control\\sub2 496 32 R0
WINDOW 0 1 -38 Invisible 2
SYMATTR InstName U9
SYMBOL Control\\mul 592 48 R0
WINDOW 0 0 -38 Invisible 2
SYMATTR InstName U10
SYMBOL Control\\adder3 752 -128 R0
WINDOW 0 0 -65 Invisible 2
SYMATTR InstName U11
SYMBOL Control\\div 976 -112 R0
WINDOW 0 0 -38 Invisible 2
SYMATTR InstName U12
SYMBOL Control\\sub2 1600 -112 R0
WINDOW 0 1 -38 Invisible 2
SYMATTR InstName U13
SYMBOL Control\\div 1760 -96 R0
WINDOW 0 0 -38 Invisible 2
SYMATTR InstName U14
SYMATTR Value eps=0
SYMBOL Control\\constant 1632 16 R0
WINDOW 0 -2 -38 Invisible 2
SYMATTR InstName U15
SYMATTR Value K={J}
SYMBOL Control\\integ 1920 -96 R0
WINDOW 0 -2 -38 Invisible 2
SYMATTR InstName U16
SYMBOL Control\\sub2 2112 32 R90
WINDOW 0 1 -38 Invisible 2
SYMATTR InstName U17
SYMBOL Control\\constant 1776 16 R0
WINDOW 0 -2 -38 Invisible 2
SYMATTR InstName U18
SYMATTR Value K={B/J}
SYMBOL Control\\mul 1920 32 R0
WINDOW 0 0 -38 Invisible 2
SYMATTR InstName U19
SYMBOL Control\\integ 1840 160 R270
WINDOW 0 -2 -38 Invisible 2
SYMATTR InstName U20
SYMBOL Control\\gain 1632 464 R180
WINDOW 0 -2 -38 Invisible 2
SYMATTR InstName U21
SYMATTR Value A={60 / (2*pi)}
SYMBOL bv 2112 528 R0
WINDOW 3 24 96 Invisible 2
SYMATTR Value V={ (V(theta_t) / (2*pi) - floor(V(theta_t) / (2*pi)) ) * 2*pi }
SYMATTR InstName B1
SYMBOL res 1968 528 R0
SYMATTR InstName R5
SYMATTR Value 1G
SYMBOL Control\\gain 848 656 R180
SYMATTR InstName U22
SYMATTR Value A=6
TEXT -376 152 Left 2 !.param Lm=30u Rm=0.08
TEXT 808 -376 Left 2 ;Conversio de domini \nelectric a mecanic
TEXT 776 -256 Left 2 ;--> Tmotor = Pe_inst / w
TEXT 840 -304 Left 2 ;Pe_inst = Pmec
TEXT -120 104 Left 2 ;Domini elèctric
TEXT 824 320 Left 2 ;Conversio de domini \nmecanic a electric
TEXT 1528 88 Left 2 !.param J=1e-6 B=2e-3
TEXT 1456 -272 Left 2 ;Domini mecànic
TEXT 2080 392 Left 2 ;Mesures
TEXT 1488 -208 Left 2 ;2ona llei Newton --> \n--> w = 1/J int(Tmotor-Tload, dt) - B/J int(w,dt)
TEXT -552 -376 Left 4 ;MODEL FUNCIONAL MOTOR
RECTANGLE Normal 1072 160 432 -400 2
RECTANGLE Normal 64 656 -400 80 1
RECTANGLE Normal 1072 720 432 288 2
RECTANGLE Normal 2256 704 1408 -304 1
RECTANGLE Normal 2192 336 1440 -240 2
RECTANGLE Normal 1440 672 2192 368 2
RECTANGLE Normal 2336 784 -624 -464
